FROM node:22-slim AS builder

WORKDIR /app
COPY . .
ARG DB_HOST
ARG DB_PORT
ARG DB_USERNAME
ARG DB_PASSWORD
ARG DB_NAME
ARG JWT_SECRET
ARG JWT_EXPIRATION
ARG PORT

ENV DB_HOST=$DB_HOST
ENV DB_PORT=$DB_PORT
ENV DB_USERNAME=$DB_USERNAME
ENV DB_PASSWORD=$DB_PASSWORD
ENV DB_NAME=$DB_NAME
ENV JWT_SECRET=$JWT_SECRET
ENV JWT_EXPIRATION=$JWT_EXPIRATION
ENV PORT=$PORT

RUN yarn run build

EXPOSE 443
EXPOSE 7512

CMD node ./dist/main.js